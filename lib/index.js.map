{"version":3,"sources":["../source/index.js"],"names":["AdmZip","require","removeMd","urlPack","hljs","rimraf","MarkdownIt","jsdom","JSDOM","markdown","html","linkify","typographer","personTemplate","fs","readFileSync","__dirname","encoding","articleTemplate","contributorTemplate","tagTemplate","languages","configure","dotenv","config","process","env","PROTOCOL","ARTICLE_SERVICE","GITHUB_TOKEN","ORG_NAME","articleSDK","ArticleSDK","ArticleBuilder","reponame","path","octokit","auth","repos","getArchiveLink","owner","repo","archive_format","ref","link","dirname","headers","replace","repoPath","zip","data","extractAllTo","existsSync","sync","renameSync","customCSSPath","customStylesTrue","listContributors","anon","per_page","page","result","contributorsList","sort","contributionsA","contributions","contributionsB","map","login","url","html_url","name","blog","md","descriptionMd","render","quotes","description","stripListLeaders","gfm","dom","elements","window","document","querySelectorAll","forEach","element","highlightBlock","getByReponame","article","translation","translations","filter","item","domain","authors","author","translators","tag1","Array","isArray","tags","length","tag2","concat","tag","ejs","trim","join","res","github","undefined","parse","pathname","slice","contributor","authorsList","user","className","type","twitter","twitterLabel","githubLabel","translatorsList","original","content","body","innerHTML","contributors","writeFileSync"],"mappings":"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","sourcesContent":["import fs from 'fs';\nimport dotenv from 'dotenv';\nimport { resolve } from 'path';\nimport ArticleSDK from '@frontender-magazine/fm-article';\nimport ejs from 'ejs';\nimport Octokit from '@octokit/rest';\n\nconst AdmZip = require('adm-zip');\nconst removeMd = require('remove-markdown');\nconst urlPack = require('url');\nconst hljs = require('highlight.js');\nconst rimraf = require('rimraf');\nconst MarkdownIt = require('markdown-it');\nconst jsdom = require('jsdom');\n\nconst { JSDOM } = jsdom;\nconst markdown = new MarkdownIt({\n  html: true,\n  linkify: true,\n  typographer: true,\n});\n\nconst personTemplate = fs.readFileSync(resolve(__dirname, '../components/Person/Person.ejs'), {\n  encoding: 'utf-8',\n});\nconst articleTemplate = fs.readFileSync(resolve(__dirname, '../components/Article/Article.ejs'), {\n  encoding: 'utf-8',\n});\nconst contributorTemplate = fs.readFileSync(\n  resolve(__dirname, '../components/Contributor/Contributor.ejs'),\n  { encoding: 'utf-8' },\n);\nconst tagTemplate = fs.readFileSync(resolve(__dirname, '../components/Tag/Tag.ejs'), {\n  encoding: 'utf-8',\n});\nconst languages = [\n  'HTML',\n  'HTMLBars',\n  'Haml',\n  'Nginx',\n  'XML',\n  'JavaScript',\n  'JSON',\n  'Markdown',\n  'Bash',\n  'TypeScript',\n  'Stylus',\n  'CSS',\n  'HTTP',\n  'Less',\n  'SCSS',\n  'YAML',\n];\nhljs.configure({\n  languages,\n});\n\ndotenv.config();\n\nconst { PROTOCOL, ARTICLE_SERVICE, GITHUB_TOKEN, ORG_NAME } = process.env;\nconst articleSDK = new ArticleSDK(`${PROTOCOL}${ARTICLE_SERVICE}`);\n\n/**\n * Transform repo to html article\n * @example\n *  (async function(){\n *    await builder(\n *      'the-art-of-html-semantics-pt1',\n *      '../websites/articles/'\n *    );\n *  })();\n * @namespace ArticleBuilder\n * @param {string} reponame - repository name\n * @param {string} path  - path where article will be created\n * @throw {Error}\n */\nconst ArticleBuilder = async (reponame, path = '../repos') => {\n  const octokit = Octokit({\n    auth: `token ${GITHUB_TOKEN}`,\n  });\n\n  const link = await octokit.repos.getArchiveLink({\n    owner: ORG_NAME,\n    repo: reponame,\n    archive_format: 'zipball',\n    ref: 'master',\n  });\n\n  const dirname = link.headers['content-disposition']\n    .replace('attachment; filename=', '')\n    .replace('.zip', '');\n  const repoPath = resolve(path, reponame);\n  const zip = new AdmZip(link.data);\n  zip.extractAllTo(path, true);\n  if (fs.existsSync(repoPath)) {\n    rimraf.sync(repoPath);\n  }\n  fs.renameSync(resolve(path, dirname), repoPath);\n  const customCSSPath = resolve(repoPath, 'styles.css');\n  const customStylesTrue = fs.existsSync(customCSSPath);\n  const result = await octokit.repos.listContributors({\n    owner: ORG_NAME,\n    repo: reponame,\n    anon: true,\n    per_page: 100,\n    page: 1,\n  });\n\n  let contributorsList = result.data\n    .sort(({ contributions: contributionsA }, { contributions: contributionsB }) => {\n      return contributionsA - contributionsB;\n    })\n    .map(({ login, html_url: url, name, blog }) => {\n      return {\n        login,\n        url,\n        name,\n        blog,\n      };\n    });\n\n  const md = fs.readFileSync(resolve(repoPath, 'rus.md'), { encoding: 'utf-8' });\n  const descriptionMd = fs.readFileSync(resolve(repoPath, 'README.md'), { encoding: 'utf-8' });\n  const html = markdown.render(md, {\n    quotes: '«»„“',\n  });\n  const description = removeMd(markdown.render(descriptionMd), {\n    stripListLeaders: true,\n    gfm: true,\n  });\n  const dom = new JSDOM(html);\n  const elements = dom.window.document.querySelectorAll('pre > code');\n  elements.forEach(element => {\n    hljs.highlightBlock(element);\n  });\n\n  let article;\n  let translation;\n  article = await articleSDK.getByReponame(reponame);\n  // eslint-disable-next-line prefer-destructuring\n  article = article[0];\n  translation = article.translations.filter(item => item.domain === 'frontender.info');\n  // eslint-disable-next-line prefer-destructuring\n  translation = translation[0];\n  const authors = article.author;\n  const translators = translation ? translation.author : [];\n\n  const tag1 = Array.isArray(article.tags) && article.tags.length > 0 ? article.tags : [];\n  const tag2 =\n    translation && Array.isArray(translation.tags) && translation.tags.length > 0\n      ? translation.tags\n      : [];\n  const tags = tag1\n    .concat(tag2)\n    .map(tag => ejs.render(tagTemplate, { tag }).trim())\n    .join(', ');\n\n  contributorsList = contributorsList\n    .filter(item => {\n      const res = authors.filter(author => {\n        if (author.github === undefined) {\n          return author.name ? author.name === item.name : false;\n        }\n        return item.login === urlPack.parse(author.github).pathname.slice(1);\n      });\n      return res.length === 0;\n    })\n    .map(contributor => ejs.render(contributorTemplate, { contributor }).trim())\n    .join(', ');\n\n  const authorsList = authors.map(author => {\n    const data = {\n      user: {\n        ...author,\n        className: 'FM__person',\n        type: 'author',\n      },\n    };\n    if (author.twitter) {\n      data.user.twitter = author.twitter;\n      data.user.twitterLabel = urlPack.parse(author.twitter).pathname;\n    }\n    if (author.github) {\n      data.user.github = author.github;\n      data.user.githubLabel = urlPack.parse(author.github).pathname;\n    }\n    return ejs.render(personTemplate, data);\n  });\n\n  const translatorsList = translators.map(author => {\n    const data = {\n      user: {\n        ...author,\n        className: 'FM__person',\n        type: 'translator',\n      },\n    };\n    if (author.twitter) {\n      data.user.twitter = author.twitter;\n      data.user.twitterLabel = urlPack.parse(author.twitter).pathname;\n    }\n    if (author.github) {\n      data.user.github = author.github;\n      data.user.githubLabel = urlPack.parse(author.github).pathname;\n    }\n    return ejs.render(personTemplate, data);\n  });\n\n  const page = ejs.render(articleTemplate, {\n    translation: translation || article,\n    customStylesTrue,\n    original: article,\n    tags,\n    content: dom.window.document.body.innerHTML,\n    contributors: contributorsList,\n    description,\n    authors: authorsList.join('').concat(translatorsList.join('')),\n  });\n\n  fs.writeFileSync(resolve(repoPath, 'index.html'), page);\n};\n\nexport default ArticleBuilder;\n"],"file":"index.js"}